---
title: "Kobi: A1 RNotebook"
author: "Kobi Schmalenberg"
output: html_notebook
---

# Package Installation and Data Setup

First we will install our necessary packages for data processing.

```{r}
if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")
if (!requireNamespace("kableExtra", quietly = TRUE))
    install.packages("BiocManager")
BiocManager::install("GEOquery")
BiocManager::install("limma")

library(GEOquery)
library(limma)
library(kableExtra)
```

Setup for getting expression data later on.

```{r}
# The chosen dataset
geoID <- "GSE208438"

# Path to store downloaded files
download_path <- file.path(getwd())

# Platform Information
gse <- getGEO(geoID, GSEMatrix = FALSE)
current_gpl <- names(GPLList(gse))[1]
current_gpl_info <- Meta(getGEO(current_gpl))
```

# Platform Information

**Platform Title:** `r current_gpl_info$title`\
**Submission Date:** `r current_gpl_info$submission_date`\
**Last Update Date:** `r current_gpl_info$last_update_date`\
**Organism:** `r current_gpl_info$organism` (taxid: `r current_gpl_info$taxid`)

# Getting the Expression Data

```{r}
# Run the function to download only files that we do not already have
suppfiles <- getGEOSuppFiles(geoID, fetch_files = FALSE)
rna_data_files <- suppfiles$fname[!unlist(lapply(suppfiles$fname, FUN=function(file){
    file.exists(file.path(download_path, geoID, file))}))]

if(length(rna_data_files) > 0){
    for(x in 1:length(rna_data_files)){
        suppfile = getGEOSuppFiles(geoID, filter_regex = rna_data_files[x], baseDir = download_path, fetch_files = TRUE)
    }
}

# Load the downloaded files for processing
sMDDvsCTRL <- read.table(file.path(download_path, geoID, "GSE208438_sMDD_vs_CTRL_fCount.txt.gz"), header=TRUE, check.names=TRUE)

dim(sMDDvsCTRL)

# Gather titles of 6 samples for bulk-seq
bulk_seq_samples <- do.call(rbind,
                            lapply(gse@gsms[seq(1:6)],
                                   FUN=function(gse){
                                       c(gse@header$title,
                                         gse@header$characteristics_ch1)
                                   }
                                )
                            )

```

# Cleaning Up the Data Table

```{r}
colnames(bulk_seq_samples) <- c("Title", "Cell Line", "Culture Time", "Tissue", "Cell Type", "Disease State")
bulk_seq_samples[, "Cell Line"] <- gsub(bulk_seq_samples[, "Cell Line"], pattern = "cell line: ", replacement="")
bulk_seq_samples[, "Culture Time"] <- gsub(bulk_seq_samples[, "Culture Time"], pattern = "culture time: ", replacement="")
bulk_seq_samples[, "Tissue"] <- gsub(bulk_seq_samples[, "Tissue"], pattern = "tissue: ", replacement="")
bulk_seq_samples[, "Cell Type"] <- gsub(bulk_seq_samples[, "Cell Type"], pattern = "cell type: ", replacement="")
bulk_seq_samples[, "Disease State"] <- gsub(bulk_seq_samples[, "Disease State"], pattern = "disease state: ", replacement="")

kable(bulk_seq_samples, format = "html")
```
